From f178d9479397a6175ce507db7b10d851afa9763e Mon Sep 17 00:00:00 2001
From: Sebastian Reichel <sebastian.reichel@collabora.com>
Date: Thu, 6 Nov 2025 16:21:05 +0100
Subject: [PATCH 103/108] net: phy: realtek: re-init after reset

The reset in the resume function results in the custom configuration
being lost, which effectively renders the 'realtek,aldps-enable'
functionality useless. Fix this up by doing a re-init as necessary.

Signed-off-by: Sebastian Reichel <sebastian.reichel@collabora.com>
---
 drivers/net/phy/realtek/realtek_main.c | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/drivers/net/phy/realtek/realtek_main.c b/drivers/net/phy/realtek/realtek_main.c
index b4053a547..895bcdd0e 100644
--- a/drivers/net/phy/realtek/realtek_main.c
+++ b/drivers/net/phy/realtek/realtek_main.c
@@ -722,11 +722,13 @@ static int rtl8211f_suspend(struct phy_device *phydev)
 static int rtl821x_resume(struct phy_device *phydev)
 {
 	struct rtl821x_priv *priv = phydev->priv;
+	bool reinit = false;
 	int ret;
 
 	if (!phydev->wol_enabled && priv->clk) {
 		clk_prepare_enable(priv->clk);
 		phy_reset_after_clk_enable(phydev);
+		reinit = true;
 	}
 
 	ret = genphy_resume(phydev);
@@ -735,6 +737,9 @@ static int rtl821x_resume(struct phy_device *phydev)
 
 	msleep(20);
 
+	if (reinit)
+		phy_init_hw(phydev);
+
 	return 0;
 }
 
-- 
2.47.3

